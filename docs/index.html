<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Perfil AfinIA</title>
  <link rel="stylesheet" href="estilos-perfil.css"/>
</head>
<body>
  <div class="contenedor">
    <div class="logo-contenedor">
      <img src="logo_afinia.png" alt="Logo AfinIA" class="logo-afinia" />
    </div>

    <header>
      <input type="text" placeholder="Buscar usuarios..." class="buscador"/>
      <button class="boton-plus">+</button>
    </header>

    <section class="perfil">
      <div class="foto-perfil-progreso" id="borde-progreso">
        <img src="foto_perfil.jpg" alt="Foto de perfil" class="foto-perfil" id="fotoPerfil" />
      </div>

      <div class="info-perfil">
        <h2>JJ Mart√≠n</h2>
        <p>@jjmartin</p>
        <p class="rol">CEO y Desarrollador</p>

        <div class="parametros"></div>

        <div class="botones-dobles">
          <a href="afinar.html" class="boton-afinar">Afinar</a>
          <button class="editar">Editar perfil</button>
        </div>
      </div>

      <!-- GALER√çA -->
      <div class="galeria-privada">
        <label class="foto-extra">
          <input type="file" accept="image/*" class="input-foto" onchange="cargarFoto(this)">
          <img src="silueta.png" alt="Foto 1" />
        </label>
        <label class="foto-extra">
          <input type="file" accept="image/*" class="input-foto" onchange="cargarFoto(this)">
          <img src="silueta.png" alt="Foto 2" />
        </label>
        <label class="foto-extra">
          <input type="file" accept="image/*" class="input-foto" onchange="cargarFoto(this)">
          <img src="silueta.png" alt="Foto 3" />
        </label>
        <label class="foto-extra">
          <input type="file" accept="image/*" class="input-foto" onchange="cargarFoto(this)">
          <img src="silueta.png" alt="Foto 4" />
        </label>
      </div>
    </section>
  </div>

  <script>
  // üëâ Cambia SOLO esta l√≠nea por tu dominio Railway
  const API_BASE = "https://afinianazan-production.up.railway.app"; // ejemplo

  async function cargarParametros() {
    try {
      const r = await fetch(`${API_BASE}/parametros`);
      const datos = await r.json();

      const sinNivel = Object.entries(datos).filter(([k]) => k !== "Nivel AfinIA");
      const top4 = sinNivel.sort((a,b)=>b[1]-a[1]).slice(0,4);

      const colores = {
        "Inteligencia": "verde",
        "Simpat√≠a": "rojo",
        "Comunicaci√≥n": "azul",
        "Carisma": "dorado",
        "Creatividad": "lavanda",
        "Resoluci√≥n de conflictos": "coral",
        "Iniciativa": "oliva",
        "Organizaci√≥n": "lila",
        "Impulso personal": "amarillo"
      };

      const cont = document.querySelector('.parametros');
      cont.innerHTML = '';

      top4.forEach(([nombre, valor])=>{
        const clase = colores[nombre] || 'gris';
        cont.innerHTML += `
          <div class="parametro">
            <span class="nombre-parametro">${nombre}</span>
            <div class="barra-base">
              <div class="barra ${clase}" style="width:${valor}%">
                <span class="porcentaje">${valor}%</span>
              </div>
            </div>
          </div>`;
      });

      // borde foto opcional‚Ä¶
      const claseTop = colores[top4[0][0]] || "";
      const foto = document.querySelector('.foto-perfil');
      if (foto && claseTop) foto.className = `foto-perfil borde-${claseTop}`;
    } catch(e){
      console.error("No pude cargar par√°metros:", e);
    }
  }

  // Chat (si est√°s en Afinar.html usa el mismo API_BASE)
  async function enviarMensaje(mensaje) {
    const r = await fetch(`${API_BASE}/chat`,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ mensaje })
    });
    const data = await r.json();
    return data.respuesta || "Lo siento, hubo un problema ‚ù§Ô∏è";
  }

  document.addEventListener("DOMContentLoaded", cargarParametros);
</script>

</body>
</html>
